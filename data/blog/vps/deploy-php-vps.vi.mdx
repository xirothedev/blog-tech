---
title: "H∆∞·ªõng d·∫´n Deploy PHP l√™n VPS: Self-hosting v·ªõi Docker v√† Nginx"
date: "2025-11-02"
lastmod: "2025-11-02"
tags: ["php", "deployment", "vps", "docker", "nginx", "self-hosting"]
draft: false
summary: "H∆∞·ªõng d·∫´n chi ti·∫øt c√°ch deploy ·ª©ng d·ª•ng PHP l√™n VPS s·ª≠ d·ª•ng Docker, MySQL v√† Nginx. Bao g·ªìm c√°c b∆∞·ªõc t·ª´ setup server ƒë·∫øn production deployment."
authors: ["default"]
locale: "vi"
images: ["/static/images/vps/deploy-php-vps/thumbnail.png"]
---

Deploy PHP l√™n VPS l√† m·ªôt k·ªπ nƒÉng c·∫ßn thi·∫øt cho c√°c developer mu·ªën t·ª± qu·∫£n l√Ω infrastructure c·ªßa m√¨nh. So v·ªõi c√°c shared hosting services, vi·ªác self-host tr√™n VPS cho b·∫°n ki·ªÉm so√°t ho√†n to√†n, t√πy ch·ªânh cao v√† hi·ªáu nƒÉng t·ªët h∆°n. B√†i vi·∫øt n√†y s·∫Ω h∆∞·ªõng d·∫´n b·∫°n deploy PHP app l√™n [VPS](/blog/vps) s·ª≠ d·ª•ng Docker, MySQL v√† Nginx.

<TOCInline
	toc={[
		{ value: "T·ªïng quan", url: "#t·ªïng-quan", depth: 2 },
		{ value: "Prerequisites", url: "#prerequisites", depth: 2 },
		{ value: "Ki·∫øn tr√∫c Deployment", url: "#ki·∫øn-tr√∫c-deployment", depth: 2 },
		{ value: "Setup Server", url: "#setup-server", depth: 2 },
		{ value: "C√†i ƒë·∫∑t Docker v√† Docker Compose", url: "#c√†i-ƒë·∫∑t-docker-v√†-docker-compose", depth: 2 },
		{ value: "Setup Nginx", url: "#setup-nginx", depth: 2 },
		{ value: "C·∫•u h√¨nh PHP Application", url: "#c·∫•u-h√¨nh-php-application", depth: 2 },
		{ value: "C·∫•u h√¨nh MySQL", url: "#c·∫•u-h√¨nh-mysql", depth: 2 },
		{ value: "Deploy Script", url: "#deploy-script", depth: 2 },
		{ value: "SSL Certificate v·ªõi Let's Encrypt", url: "#ssl-certificate-v·ªõi-lets-encrypt", depth: 2 },
		{ value: "Rate Limiting v√† Security", url: "#rate-limiting-v√†-security", depth: 2 },
		{ value: "Update v√† Maintenance", url: "#update-v√†-maintenance", depth: 2 },
		{ value: "Troubleshooting", url: "#troubleshooting", depth: 2 },
		{ value: "Best Practices", url: "#best-practices", depth: 2 },
		{ value: "K·∫øt lu·∫≠n", url: "#k·∫øt-lu·∫≠n", depth: 2 },
	]}
	asDisclosure={true}
	collapse={false}
/>

## T·ªïng quan

H∆∞·ªõng d·∫´n n√†y s·∫Ω h∆∞·ªõng d·∫´n b·∫°n deploy ·ª©ng d·ª•ng PHP ƒë∆°n gi·∫£n v·ªõi MySQL database tr√™n Ubuntu server s·ª≠ d·ª•ng Docker v√† Nginx. Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng v√≠ d·ª• t·ª´ [th∆∞ m·ª•c examples](/examples/php-simple-app) trong repository n√†y.

<GitHubSourceLink path="examples/php-simple-app" text="üì¶ Xem source code tr√™n GitHub" />

### Stack c√¥ng ngh·ªá:

| Component            | Technology              | M·ª•c ƒë√≠ch                                        |
| -------------------- | ----------------------- | ----------------------------------------------- |
| **Application**      | PHP 8.2                 | Server-side scripting language                  |
| **Database**         | MySQL 8.0               | Relational database                             |
| **Containerization** | Docker & Docker Compose | Isolate v√† qu·∫£n l√Ω containers                   |
| **Web Server**       | Nginx                   | Reverse proxy, SSL termination, PHP-FPM handler |
| **PHP Runtime**      | PHP-FPM                 | FastCGI Process Manager cho PHP                 |
| **SSL**              | Let's Encrypt           | HTTPS encryption                                |
| **OS**               | Ubuntu Linux            | Server operating system                         |

### T·∫°i sao Self-hosting PHP?

**∆Øu ƒëi·ªÉm:**

- ‚úÖ Ki·ªÉm so√°t ho√†n to√†n infrastructure
- ‚úÖ Chi ph√≠ c√≥ th·ªÉ th·∫•p h∆°n managed hosting
- ‚úÖ T√πy ch·ªânh PHP extensions v√† config
- ‚úÖ Hi·ªÉu r√µ c√°ch h·ªá th·ªëng ho·∫°t ƒë·ªông
- ‚úÖ Kh√¥ng b·ªã gi·ªõi h·∫°n b·ªüi hosting provider rules

**Nh∆∞·ª£c ƒëi·ªÉm:**

- ‚ùå C·∫ßn qu·∫£n l√Ω v√† maintain server
- ‚ùå Tr√°ch nhi·ªám v·ªÅ security v√† updates
- ‚ùå C·∫ßn ki·∫øn th·ª©c v·ªÅ DevOps
- ‚ùå Kh√¥ng c√≥ managed scaling t·ª± ƒë·ªông

## Prerequisites

Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu, b·∫°n c·∫ßn chu·∫©n b·ªã:

### 1. **Domain Name**

Mua m·ªôt domain name v√† chu·∫©n b·ªã c·∫•u h√¨nh DNS:

- T·∫°o A record tr·ªè ƒë·∫øn IP c·ªßa VPS
- Th·ªùi gian propagate: th∆∞·ªùng 5-30 ph√∫t, c√≥ th·ªÉ ƒë·∫øn 48 gi·ªù

### 2. **VPS Server**

Y√™u c·∫ßu t·ªëi thi·ªÉu cho PHP app:

- **RAM**: 1GB+ (khuy·∫øn ngh·ªã 2GB+)
- **CPU**: 1 core+ (khuy·∫øn ngh·ªã 2 cores)
- **Storage**: 20GB+ (khuy·∫øn ngh·ªã 40GB+)
- **OS**: Ubuntu 20.04 LTS ho·∫∑c m·ªõi h∆°n

**N∆°i mua VPS:**

- DigitalOcean (Droplets)
- AWS EC2
- Azure VMs
- Linode
- Vultr

### 3. **Ki·∫øn th·ª©c c∆° b·∫£n**

- SSH v√† command line
- Git basics
- Hi·ªÉu c∆° b·∫£n v·ªÅ Docker
- Quen thu·ªôc v·ªõi PHP

## Ki·∫øn tr√∫c Deployment

<Image
	width={1000}
	height={600}
	src="/static/images/vps/deploy-php-vps/architecture.svg"
	alt="Ki·∫øn tr√∫c Deployment PHP"
/>

### Lu·ªìng request:

```
User ‚Üí Domain ‚Üí DNS ‚Üí Nginx (Port 80/443)
                        ‚Üì
                   Docker Network
                        ‚Üì
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚Üì                   ‚Üì
        PHP-FPM Container   MySQL Container
        (Port 9000)         (Port 3306)
```

### C√°c th√†nh ph·∫ßn:

1. **Nginx**: Reverse proxy, x·ª≠ l√Ω SSL, route requests ƒë·∫øn PHP-FPM
2. **PHP-FPM Container**: Ch·∫°y PHP application v·ªõi PHP-FPM
3. **MySQL Container**: Database server
4. **Docker Network**: K·∫øt n·ªëi c√°c containers

## Setup Server

### 1. **SSH v√†o Server**

```bash
ssh root@your_server_ip
# ho·∫∑c n·∫øu d√πng non-root user
ssh user@your_server_ip
```

### 2. **Update h·ªá th·ªëng**

```bash
sudo apt update && sudo apt upgrade -y
```

### 3. **C√†i ƒë·∫∑t c√°c packages c∆° b·∫£n**

```bash
sudo apt install -y curl wget git build-essential
```

## C√†i ƒë·∫∑t Docker v√† Docker Compose

### C√†i ƒë·∫∑t Docker

```bash
# Remove old versions
for pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; do sudo apt-get remove $pkg; done

# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

# Install latest version
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Start Docker service
sudo systemctl start docker
sudo systemctl enable docker

# Verify installation
docker --version
```

### Th√™m user v√†o docker group (optional)

```bash
sudo usermod -aG docker $USER
newgrp docker
```

## Setup Nginx

Ph·∫ßn n√†y h∆∞·ªõng d·∫´n c√†i ƒë·∫∑t v√† c·∫•u h√¨nh Nginx tr√™n Ubuntu 20.04, d·ª±a tr√™n [h∆∞·ªõng d·∫´n ch√≠nh th·ª©c c·ªßa DigitalOcean](https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04).

### C√†i ƒë·∫∑t Nginx

```bash
# Update package index
sudo apt update

# Install Nginx
sudo apt install nginx

# Verify installation
nginx -v
```

### ƒêi·ªÅu ch·ªânh Firewall

Tr∆∞·ªõc khi ki·ªÉm tra Nginx, b·∫°n c·∫ßn ƒëi·ªÅu ch·ªânh firewall ƒë·ªÉ cho ph√©p traffic:

```bash
# Check firewall status
sudo ufw status

# N·∫øu firewall ch∆∞a active, enable n√≥
sudo ufw enable

# Allow OpenSSH (quan tr·ªçng - n·∫øu kh√¥ng b·∫°n c√≥ th·ªÉ b·ªã lock out)
sudo ufw allow 'OpenSSH'

# Allow Nginx traffic
sudo ufw allow 'Nginx Full'

# Verify firewall rules
sudo ufw status
```

> [!WARNING]
> **Quan tr·ªçng**: Lu√¥n cho ph√©p OpenSSH tr∆∞·ªõc khi enable firewall, n·∫øu kh√¥ng b·∫°n c√≥ th·ªÉ b·ªã lock out kh·ªèi server!

### Ki·ªÉm tra Web Server

```bash
# Check Nginx status
sudo systemctl status nginx

# N·∫øu ch∆∞a ch·∫°y, start Nginx
sudo systemctl start nginx

# Enable Nginx ƒë·ªÉ t·ª± ƒë·ªông start khi reboot
sudo systemctl enable nginx
```

### C·∫•u h√¨nh Server Blocks cho PHP

```bash
# T·∫°o file config cho domain c·ªßa b·∫°n
sudo nano /etc/nginx/sites-available/your-domain.com
```

N·ªôi dung file config cho PHP v·ªõi PHP-FPM:

```nginx
server {
    listen 80;
    listen [::]:80;

    server_name your-domain.com www.your-domain.com;

    root /var/www/html;
    index index.php index.html index.htm;

    # Logging
    access_log /var/log/nginx/your-domain.access.log;
    error_log /var/log/nginx/your-domain.error.log;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass php-fpm:9000;  # PHP-FPM container
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }
}
```

## C·∫•u h√¨nh PHP Application

### 1. **C·∫•u tr√∫c Project**

T·ª´ th∆∞ m·ª•c examples <GitHubSourceLink path="examples/php-simple-app" />, project c√≥ c·∫•u tr√∫c:

```
php-simple-app/
‚îú‚îÄ‚îÄ src/                    # PHP source code
‚îÇ   ‚îú‚îÄ‚îÄ index.php          # Main entry point
‚îÇ   ‚îú‚îÄ‚îÄ config.php         # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ db.php             # Database connection
‚îú‚îÄ‚îÄ public/                # Public files (assets)
‚îú‚îÄ‚îÄ Dockerfile             # PHP-FPM container definition
‚îú‚îÄ‚îÄ docker-compose.yml     # Multi-container setup
‚îú‚îÄ‚îÄ nginx.conf             # Nginx configuration
‚îú‚îÄ‚îÄ deploy.sh              # Deployment script
‚îî‚îÄ‚îÄ .env.example           # Environment variables example
```

### 2. **Dockerfile cho PHP-FPM**

```dockerfile
FROM php:8.2-fpm-alpine

# Install system dependencies
RUN apk add --no-cache \
    git \
    curl \
    libpng-dev \
    libzip-dev \
    zip \
    unzip \
    mysql-client

# Install PHP extensions
RUN docker-php-ext-install pdo_mysql mysqli zip gd

# Install Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Set working directory
WORKDIR /var/www/html

# Copy application files
COPY src/ /var/www/html/
COPY public/ /var/www/html/public/

# Set permissions
RUN chown -R www-data:www-data /var/www/html
RUN chmod -R 755 /var/www/html

# Expose PHP-FPM port
EXPOSE 9000

CMD ["php-fpm"]
```

### 3. **docker-compose.yml**

```yaml
services:
    nginx:
        image: nginx:alpine
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - ./src:/var/www/html:ro
            - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
        depends_on:
            - php-fpm
        networks:
            - app_network

    php-fpm:
        build:
            context: .
            dockerfile: Dockerfile
        volumes:
            - ./src:/var/www/html
            - ./public:/var/www/html/public
        environment:
            - DB_HOST=mysql
            - DB_NAME=${DB_NAME}
            - DB_USER=${DB_USER}
            - DB_PASSWORD=${DB_PASSWORD}
        depends_on:
            - mysql
        networks:
            - app_network

    mysql:
        image: mysql:8.0
        environment:
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_DATABASE: ${DB_NAME}
            MYSQL_USER: ${DB_USER}
            MYSQL_PASSWORD: ${DB_PASSWORD}
        volumes:
            - mysql_data:/var/lib/mysql
        ports:
            - "3306:3306"
        networks:
            - app_network

volumes:
    mysql_data:

networks:
    app_network:
        driver: bridge
```

### 4. **V√≠ d·ª• PHP Application (index.php)**

```php
<?php
require_once 'config.php';
require_once 'db.php';

$db = new Database();
$conn = $db->getConnection();

// Example query
$stmt = $conn->prepare("SELECT * FROM users LIMIT 10");
$stmt->execute();
$users = $stmt->fetchAll(PDO::FETCH_ASSOC);

?>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP Simple App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ PHP Application tr√™n VPS</h1>

        <div class="info">
            <strong>Server Info:</strong><br>
            PHP Version: <?php echo phpversion(); ?><br>
            Server: <?php echo $_SERVER['SERVER_SOFTWARE']; ?><br>
            Document Root: <?php echo $_SERVER['DOCUMENT_ROOT']; ?>
        </div>

        <h2>Database Connection: ‚úÖ Connected</h2>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($users)): ?>
                    <tr>
                        <td colspan="4">No users found. Run database migrations first.</td>
                    </tr>
                <?php else: ?>
                    <?php foreach ($users as $user): ?>
                        <tr>
                            <td><?php echo htmlspecialchars($user['id']); ?></td>
                            <td><?php echo htmlspecialchars($user['name']); ?></td>
                            <td><?php echo htmlspecialchars($user['email']); ?></td>
                            <td><?php echo htmlspecialchars($user['created_at']); ?></td>
                        </tr>
                    <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</body>
</html>
```

## C·∫•u h√¨nh MySQL

### Database Setup

Sau khi containers ch·∫°y, setup database:

```bash
# V√†o MySQL container
docker exec -it php-simple-app-mysql-1 mysql -u root -p

# T·∫°o database v√† user (n·∫øu ch∆∞a c√≥)
CREATE DATABASE IF NOT EXISTS myapp_db;
CREATE USER IF NOT EXISTS 'myuser'@'%' IDENTIFIED BY 'mypassword';
GRANT ALL PRIVILEGES ON myapp_db.* TO 'myuser'@'%';
FLUSH PRIVILEGES;
EXIT;
```

### T·∫°o Tables

```bash
# V√†o PHP container
docker exec -it php-simple-app-php-fpm-1 sh

# Ho·∫∑c import SQL file
docker exec -i php-simple-app-mysql-1 mysql -u myuser -pmypassword myapp_db < schema.sql
```

V√≠ d·ª• schema.sql:

```sql
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO users (name, email) VALUES
('John Doe', 'john@example.com'),
('Jane Smith', 'jane@example.com'),
('Bob Johnson', 'bob@example.com');
```

## Deploy Script

Deploy script t·ª± ƒë·ªông h√≥a to√†n b·ªô qu√° tr√¨nh deployment:

### C√°c b∆∞·ªõc script th·ª±c hi·ªán:

| B∆∞·ªõc                     | C√¥ng vi·ªác               | Chi ti·∫øt                                 |
| ------------------------ | ----------------------- | ---------------------------------------- |
| **1. Setup Packages**    | C√†i ƒë·∫∑t dependencies    | curl, git, Docker, Docker Compose, Nginx |
| **2. Clone Repository**  | Download source code    | Clone t·ª´ Git ho·∫∑c copy local files       |
| **3. Generate SSL**      | T·∫°o SSL certificate     | S·ª≠ d·ª•ng Certbot (Let's Encrypt)          |
| **4. Build Application** | Build PHP-FPM container | Docker build v·ªõi Dockerfile              |
| **5. Configure Nginx**   | Setup reverse proxy     | C·∫•u h√¨nh HTTPS, PHP-FPM integration      |
| **6. Setup Database**    | Initialize MySQL        | T·∫°o database v√† tables                   |
| **7. Start Services**    | Kh·ªüi ƒë·ªông containers    | docker-compose up -d                     |
| **8. Setup Cron**        | Automated tasks         | SSL renewal, backups                     |

### S·ª≠ d·ª•ng Deploy Script

```bash
# Download script
curl -o ~/deploy-php.sh https://raw.githubusercontent.com/xirothedev/blog-tech/main/deploy-php.sh

# Ch·ªânh s·ª≠a c√°c bi·∫øn
nano ~/deploy-php.sh
# Thay ƒë·ªïi: EMAIL, DOMAIN_NAME, DB credentials

# Ch·∫°y script
chmod +x ~/deploy-php.sh
./deploy-php.sh
```

### V√≠ d·ª• deploy.sh

```bash
#!/bin/bash

set -e

# Configuration
EMAIL="your-email@example.com"
DOMAIN="your-domain.com"
PROJECT_DIR="/opt/php-app"

echo "Starting PHP deployment..."

# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Install Nginx
sudo apt install -y nginx

# Copy project files
if [ -d "$PROJECT_DIR" ]; then
    cd $PROJECT_DIR && git pull
else
    git clone https://github.com/xirothedev/blog-tech/php-app.git $PROJECT_DIR
    cd $PROJECT_DIR
fi

# Generate SSL certificate
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d $DOMAIN --non-interactive --agree-tos -m $EMAIL

# Build and start containers
cd $PROJECT_DIR
sudo docker-compose build
sudo docker-compose up -d

echo "Deployment completed!"
```

## SSL Certificate v·ªõi Let's Encrypt

### C√†i ƒë·∫∑t Certbot

```bash
sudo apt install -y certbot python3-certbot-nginx
```

### Generate SSL Certificate

```bash
# Automatic configuration v·ªõi Nginx
sudo certbot --nginx -d your-domain.com

# Ho·∫∑c ch·ªâ generate certificate
sudo certbot certonly --nginx -d your-domain.com
```

### Auto-renewal

Certbot t·ª± ƒë·ªông setup cron job ƒë·ªÉ renew certificate:

```bash
# Test renewal
sudo certbot renew --dry-run

# Check renewal status
sudo systemctl status certbot.timer
```

## Rate Limiting v√† Security

### Nginx Rate Limiting

```nginx
# /etc/nginx/nginx.conf
http {
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

    server {
        location / {
            limit_req zone=api_limit burst=20 nodelay;
            try_files $uri $uri/ /index.php?$query_string;
        }
    }
}
```

### Security Headers

```nginx
server {
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # Hide PHP version
    fastcgi_hide_header X-Powered-By;
}
```

### PHP Security Settings

Trong `php.ini`:

```ini
; Disable dangerous functions
disable_functions = exec,passthru,shell_exec,system,proc_open,popen

; Hide PHP version
expose_php = Off

; Error reporting (production)
display_errors = Off
log_errors = On
```

## Update v√† Maintenance

### Maintenance Commands

| M·ª•c ƒë√≠ch                  | Command                                    | M√¥ t·∫£                                 |
| ------------------------- | ------------------------------------------ | ------------------------------------- |
| **Check containers**      | `docker-compose ps`                        | Xem tr·∫°ng th√°i containers             |
| **View PHP logs**         | `docker-compose logs php-fpm`              | Xem logs c·ªßa PHP-FPM                  |
| **View Nginx logs**       | `docker-compose logs nginx`                | Xem logs c·ªßa Nginx                    |
| **View MySQL logs**       | `docker-compose logs mysql`                | Xem logs c·ªßa MySQL                    |
| **Restart services**      | `docker-compose restart`                   | Kh·ªüi ƒë·ªông l·∫°i t·∫•t c·∫£ services         |
| **Stop services**         | `docker-compose down`                      | D·ª´ng v√† x√≥a containers                |
| **Start services**        | `docker-compose up -d`                     | Kh·ªüi ƒë·ªông containers trong background |
| **Enter PHP container**   | `docker exec -it php-fpm-1 sh`             | V√†o trong PHP container               |
| **Enter MySQL container** | `docker exec -it mysql-1 mysql -u root -p` | V√†o MySQL CLI                         |

### Backup Strategy

| Lo·∫°i Backup               | T·∫ßn su·∫•t       | C√°ch th·ª±c hi·ªán                        |
| ------------------------- | -------------- | ------------------------------------- |
| **Database Backup**       | Daily          | `mysqldump` ho·∫∑c Docker volume backup |
| **Application Code**      | Per deployment | Git repository                        |
| **Environment Variables** | On changes     | Secure storage                        |
| **Docker Volumes**        | Weekly         | Volume backup scripts                 |

### Backup Database

```bash
# Backup MySQL
docker exec php-simple-app-mysql-1 mysqldump -u myuser -pmypassword myapp_db > backup_$(date +%Y%m%d).sql

# Restore from backup
docker exec -i php-simple-app-mysql-1 mysql -u myuser -pmypassword myapp_db < backup_20250101.sql
```

## Troubleshooting

### C√°c v·∫•n ƒë·ªÅ th∆∞·ªùng g·∫∑p

| V·∫•n ƒë·ªÅ                        | Nguy√™n nh√¢n c√≥ th·ªÉ    | Gi·∫£i ph√°p                            |
| ----------------------------- | --------------------- | ------------------------------------ |
| **502 Bad Gateway**           | PHP-FPM kh√¥ng ch·∫°y    | Ki·ªÉm tra `docker-compose ps` v√† logs |
| **Database connection error** | Connection string sai | Ki·ªÉm tra DB credentials trong .env   |
| **Nginx 404**                 | File paths kh√¥ng ƒë√∫ng | Ki·ªÉm tra root v√† index settings      |
| **PHP errors kh√¥ng hi·ªán**     | display_errors = Off  | Ki·ªÉm tra php.ini ho·∫∑c logs           |
| **SSL certificate fail**      | DNS ch∆∞a propagate    | ƒê·ª£i DNS update                       |

### Debug Commands

```bash
# Check Docker containers
docker ps -a

# Check Docker logs
docker-compose logs --tail=100 php-fpm
docker-compose logs --tail=100 nginx

# Check Nginx config
sudo nginx -t

# Check PHP-FPM status
docker exec php-fpm-1 php-fpm -v

# Test database connection
docker exec mysql-1 mysql -u myuser -pmypassword -e "SHOW DATABASES;"
```

## Best Practices

### 1. **Environment Variables**

| Bi·∫øn          | M√¥ t·∫£                  | B·∫£o m·∫≠t                              |
| ------------- | ---------------------- | ------------------------------------ |
| `DB_HOST`     | MySQL host             | ‚úÖ Kh√¥ng commit v√†o Git              |
| `DB_NAME`     | Database name          | ‚ö†Ô∏è C√≥ th·ªÉ commit n·∫øu kh√¥ng sensitive |
| `DB_USER`     | Database user          | ‚úÖ Kh√¥ng commit                      |
| `DB_PASSWORD` | Database password      | ‚úÖ Kh√¥ng commit                      |
| `APP_ENV`     | Environment (prod/dev) | ‚úÖ Set trong Docker                  |

### 2. **PHP Best Practices**

| Practice                    | Benefit                  | Implementation         |
| --------------------------- | ------------------------ | ---------------------- |
| **Use prepared statements** | Prevent SQL injection    | PDO or mysqli          |
| **Error handling**          | Better debugging         | try-catch blocks       |
| **Input validation**        | Security                 | Filter input, validate |
| **Cache opcache**           | Performance              | Enable OPcache         |
| **Composer autoload**       | Better code organization | Use PSR-4 autoloading  |

### 3. **Docker Best Practices**

| Practice               | L√Ω do              | Implementation                   |
| ---------------------- | ------------------ | -------------------------------- |
| **Multi-stage builds** | Gi·∫£m image size    | Separate build v√† runtime        |
| **Non-root user**      | Security           | Run v·ªõi www-data user            |
| **.dockerignore**      | Faster builds      | Exclude vendor, .git             |
| **Health checks**      | Auto-recovery      | Healthcheck trong docker-compose |
| **Resource limits**    | Prevent exhaustion | Set CPU/memory limits            |

### 4. **Security Checklist**

- ‚úÖ Keep system updated
- ‚úÖ Use strong passwords
- ‚úÖ Enable firewall (UFW)
- ‚úÖ SSH key authentication
- ‚úÖ Regular security audits
- ‚úÖ Monitor logs
- ‚úÖ Use HTTPS only
- ‚úÖ Security headers trong Nginx
- ‚úÖ Rate limiting
- ‚úÖ Database access restrictions
- ‚úÖ Hide PHP version
- ‚úÖ Disable dangerous PHP functions

## K·∫øt lu·∫≠n

Deploy PHP l√™n VPS l√† m·ªôt qu√° tr√¨nh c√≥ th·ªÉ ph·ª©c t·∫°p nh∆∞ng mang l·∫°i nhi·ªÅu l·ª£i √≠ch: ki·ªÉm so√°t ho√†n to√†n, chi ph√≠ linh ho·∫°t v√† hi·ªáu nƒÉng t·ªët. V·ªõi Docker v√† Nginx, b·∫°n c√≥ th·ªÉ setup m·ªôt production-ready deployment.

### ƒêi·ªÉm m·∫•u ch·ªët

- ‚úÖ **Docker simplifies deployment** - Containerization gi√∫p d·ªÖ qu·∫£n l√Ω
- ‚úÖ **Nginx + PHP-FPM** - Hi·ªáu nƒÉng t·ªët cho PHP applications
- ‚úÖ **MySQL for data** - Reliable database solution
- ‚úÖ **SSL/HTTPS** - B·∫£o m·∫≠t cho production
- ‚úÖ **Automation is key** - Deploy scripts gi√∫p ti·∫øt ki·ªám th·ªùi gian

### T√†i nguy√™n tham kh·∫£o

- üì¶ [PHP Simple App Example](/examples/php-simple-app) - Source code m·∫´u
    <GitHubSourceLink path="examples/php-simple-app" />
- üìö [PHP Documentation](https://www.php.net/docs.php)
- üê≥ [Docker Documentation](https://docs.docker.com/)
- üåê [Nginx Documentation](https://nginx.org/en/docs/)
- üìò [MySQL Documentation](https://dev.mysql.com/doc/)

### B∆∞·ªõc ti·∫øp theo

1. **Clone example project**: Th·ª≠ nghi·ªám v·ªõi [php-simple-app](/examples/php-simple-app)
2. **Customize**: T√πy ch·ªânh theo nhu c·∫ßu c·ªßa b·∫°n
3. **Deploy**: Ch·∫°y deploy script tr√™n VPS
4. **Monitor**: Setup monitoring v√† alerting
5. **Optimize**: T·ªëi ∆∞u performance

> [!TIP]
> **B·∫Øt ƒë·∫ßu v·ªõi example**: S·ª≠ d·ª•ng [php-simple-app](/examples/php-simple-app) nh∆∞ m·ªôt starting point ƒë·ªÉ hi·ªÉu c√°ch setup v√† customize cho project c·ªßa b·∫°n!

> [!NOTE]
>
> - [PHP Official Documentation](https://www.php.net/)
> - [Docker PHP Images](https://hub.docker.com/_/php)
> - [Nginx PHP-FPM Configuration](https://www.nginx.com/resources/wiki/start/topics/examples/phpfcgi/)
